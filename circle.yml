machine:
  timezone:
    Europe/Berlin
  environment:
    MAKEFLAGS: ""
## ----------- WIN cross compile ----------------
    TARGET_HOST: "--host=x86_64-w64-mingw32"
    TARGET_TRGT: "--target=x86_64-win32-gcc"
    CROSS: "x86_64-w64-mingw32-"
    GL_BUILD: "win64"
## ----------- WIN cross compile ----------------
    # ---------------------------------------------------
    # MAX_CRYPTO_PACKET_SIZE 1400 -> 1000      4e096ac87135ef15bc9b738006a91f9b455b9f54
    # jitterbuffer  capacity 3 -> 10           8317821ed02f549380bbb05f2b80c44693a7bcb0
    # v0.1.10 onlyKF    74dc53cf180e32f92ebb3cb5e8542e919cc3b343
    # v0.1.10 mobtweaks f73b345c21fae0e0e56fae86dc82f63188a00aca
    # c-toxcore v0.1.9 a429ef4a28a5e5e0ad010efffb76d2abc3ada0af
    # c-toxcore v0.1.8 f6db9333e2d1262e7ba3846563c30f63c98ffa38
    # c-toxcore v0.1.7 48c86e942d487a8856cbd25797b320bfb1879ddc
    # c-toxcore v0.1.6 895de7ef26e7617769f2271345e414545c2581f8
    # c-toxcore v0.1.5 995578f1038842288c1ff552fd796ab2377db6e1
    # c-toxcore v0.1.4 27a97a8280813ec05a5209811c40ab23203bb292
    # c-toxcore v0.1.3 fdb46f6cf216a866d29402ae991be9c43282dde6
    # c-toxcore v0.1.2 a096c71db867ac83fc3e01e0fbe98573d20f9286
    # ---------------------------------------------------
    # c-toxcore version used
    CTOXCORE_VERSION_HASH: f73b345c21fae0e0e56fae86dc82f63188a00aca
    # c-toxcore repo used
    # CTOXCORE_URL: "https://github.com/TokTok/c-toxcore"
    CTOXCORE_URL: "https://github.com/zoff99/c-toxcore"
    TOXCORE_REPO_URI: "https://github.com/zoff99/c-toxcore"

dependencies:
  pre:
    # -----------------------------------
    - sudo /etc/init.d/mysql stop ; exit 0
    - sudo /etc/init.d/postgresql stop ; exit 0
    # -----------------------------------
    - sudo apt-get update
    - sudo apt-get install cmake
    - sudo apt-get install build-essential libtool autotools-dev automake checkinstall check git yasm libv4lconvert0 libv4l-dev
    - sudo apt-get install libopus-dev libvpx-dev pkg-config
    - sudo apt-get install libasound2-dev
    - sudo apt-get install mingw-w64 mingw-w64-tools gobjc++-mingw-w64 gobjc-mingw-w64 mingw32-binutils mingw32-runtime gcc-mingw-w64
    - sudo apt-get install g++-mingw-w64 binutils-mingw-w64 binutils-mingw-w64-x86-64
    - sudo apt-get install mingw32 mingw32-binutils mingw32-runtime 

    - sudo bash -c "echo '::1             localhost ipv6-localhost ipv6-loopback' >> /etc/hosts" # ipv6 localhost entry

    - gcc --version ; exit 0
    - clang --version ; exit 0

    - bash -x ./extra/gitlab/windows-before.sh
    - bash -x ./extra/gitlab/windows-script.sh
    - ls -al build_win/utox.exe
    - file build_win/utox.exe ; exit 0
    - ls -al cache/win64/usr/bin/*dll

    - mkdir -p $CIRCLE_ARTIFACTS/win_binaries/
    - cp -av build_win/utox.exe $CIRCLE_ARTIFACTS/win_binaries/
    - cp -av cache/win64/usr/bin/libopus-0.dll $CIRCLE_ARTIFACTS/win_binaries/
    - cp -av cache/win64/usr/bin/libsodium-23.dll $CIRCLE_ARTIFACTS/win_binaries/

## ----------- WIN cross compile ----------------
## ----------- WIN cross compile ----------------

compile:
  override:
    - echo "xxx"

test:
  override:
    - echo "-- dummy --"
